
# [최종 상세 기획서] 모아 캘린더 (Moa Calendar) v1.1
**부제: 관계와 맥락을 담은 올인원 공유 자산 관리**

## 1. 서비스 정책 및 계정 (Policy & Account)

### 1.1 인증 및 회원가입
*   **가입 방식:** 이메일(ID) + 비밀번호.
*   **프로필 설정:** 닉네임, 프로필 이미지, **고유 색상(8종 택 1)**.
*   **초기 세팅 (Onboarding):**
    *   회원가입 직후 **'내 캘린더'**의 **이름**(예: 민수의 하루)과 **테마 색상**을 설정합니다.
    *   *Note: 가계부 시작일은 설정하지 않으며, 기본값인 '1일'로 자동 지정됩니다.*

### 1.2 그룹 및 초대 정책 (수정됨)
*   **초대 방식 (In-App Invite):**
    1.  호스트가 `설정 > 멤버 초대`에서 **이미 가입된 유저의 이메일(ID)**을 검색하여 초대를 발송합니다.
    2.  초대받은 유저가 앱에 진입(로그인)하면 **초대 팝업**이 노출됩니다.
    3.  **[수락]** 시 그룹에 합류하며, **[거절]** 시 팝업이 닫힙니다.
*   **멤버 수:** 최대 10인 제한.
*   **삭제/강퇴:** 호스트만 가능하며, 삭제 시 그룹 내 '공용(Joint)' 데이터는 영구 삭제됩니다.

---

## 2. 핵심 기능 로직 (Core Logic)

### 2.1 캘린더 & 일정 (Schedule)
*   **뷰(View):** 가계부 기준일 설정과 무관하게 달력은 항상 **1일~말일**을 표시합니다.
*   **인터랙션:**
    *   **1 Tap:** 하단 리스트 영역에 조회/수정 화면 노출.
    *   **2 Tap:** 신규 등록 모달 노출.
    *   **하단 [+] 버튼:** 리스트 영역 내에서 빠른 등록.

### 2.2 자산 및 가계부 (Transaction)
*   **가계부 시작일 (Budget Cycle):**
    *   **기본값:** 매월 **1일**.
    *   **변경:** `햄버거 메뉴 > 설정`에서 1일, 15일, 25일 등으로 변경 가능하며, 변경 시 통계/예산 계산 기준만 바뀝니다.
*   **자산 성격 (Asset Type):**
    *   **Personal (개인):** 내 지출 (기본 분홍색).
    *   **Joint (공용):** 공유 지출 (기본 파란색). *멤버 초대 수락 시 활성화.*
*   **자산 출처 (Asset Source):** 현금, 카드, 통장 등 실제 결제 수단 관리.

---

## 3. 통합 유저 시나리오 (User Scenario)

### Phase 1. 싱글 모드: 민수(Host)의 시작
**상황:** 30대 직장인 민수가 가입하여 개인 자산 관리를 시작함.

1.  **가입 및 캘린더 생성:**
    *   민수는 회원가입을 완료한다.
    *   "캘린더를 설정해주세요" 화면에서 이름에 **"민수의 하루"**, 색상은 **'파란색'**을 선택하고 완료한다.
2.  **메인 진입:**
    *   앱이 실행되고 1일~말일 달력이 보인다. (현재 가계부 기준일은 기본값인 **1일**이다).
3.  **설정 변경 (기준일):**
    *   민수는 월급날이 25일이라 기준을 바꾸고 싶다.
    *   우측 상단 **햄버거 메뉴(≡)** > **[앱 설정]** > **[가계부 시작일]**로 이동해 **'25일'**로 변경한다.
4.  **일정 및 지출 등록:**
    *   14일 날짜를 **따닥(2 Tap)** 누른다.
    *   `[일정]` 탭에서 "치과 예약"을 등록한다.
    *   다시 하단 리스트의 **`[+]` 버튼**을 눌러 `[지출]` 탭에서 30,000원(의료비)을 입력하고 "치과 예약" 일정과 연결해 저장한다.

### Phase 2. 확장 모드: 지은(Guest) 초대 및 합류 (수정됨)
**상황:** 민수가 아내 지은과 캘린더를 공유하기로 함.

1.  **게스트 가입 (선행):**
    *   지은은 먼저 앱을 설치하고 회원가입을 한다.
    *   자신의 캘린더 이름("지은 달력")과 색상(**주황**)을 정하고 메인에 진입해 있는다.
2.  **초대 발송 (Host):**
    *   민수는 햄버거 메뉴 > **[멤버 초대]**로 들어간다.
    *   지은의 아이디(`jieun@email.com`)를 검색하여 **[초대 보내기]**를 누른다.
3.  **초대 수락 (Guest):**
    *   지은이 앱을 다시 켜거나 새로고침하자, 화면 중앙에 **"민수님이 '민수의 하루' 캘린더에 초대했습니다."** 팝업이 뜬다.
    *   **[수락]** 버튼을 누른다.
4.  **화면 전환:**
    *   지은의 상단 캘린더 이름이 `지은 달력`에서 **`민수의 하루`**로 바뀐다.
    *   민수가 기록해둔 일정들이 보이고, 상단 필터 바에 **[All] - [Me] - [민수]**가 생긴다.

### Phase 3. 협업 모드: 공용 자산 관리
**상황:** 지은(Guest)이 공용 생활비로 장을 봄.

1.  **공용 지출 등록:**
    *   지은은 20일 날짜를 **더블 탭** 한다.
    *   `[지출]` 탭, 금액 100,000원 입력.
    *   **Type:** 활성화된 **`[Joint]`(공용)** 버튼을 누른다 (색상이 파란색 테마로 변함).
    *   **자산:** 민수가 등록해둔 `공용 생활비통장`을 선택해 저장한다.
2.  **확인 (Host):**
    *   민수의 달력 20일에 "-100,000원"이 즉시 표시된다.
    *   하단 `[통계]` 탭을 보면 이번 달(25일 기준) 예산에서 10만 원이 차감된 것을 확인할 수 있다.

---

## 4. 화면 및 UI 상세 명세 (UI Specification)

### #1. 메인 캘린더 (Calendar Tab)
*   **Header:**
    *   `캘린더명 ▼` (내 달력 / 공유받은 달력 전환).
    *   `Filter Bar`: `All` / `Me` / `Partner`(상대방 닉네임).
    *   `Hamburger(≡)`: 설정 메뉴 진입.
*   **Grid:** 1일~말일 표시.
    *   일정: 유저 색상 바.
    *   가계부: `개인(설정색)`, `공용(설정색)` 텍스트.
*   **Bottom Interaction:**
    *   **영역:** 달력 하단, 탭 메뉴 상단.
    *   **구성:** 선택된 날짜의 리스트 (Scroll View).
    *   **Action:** 우측 상단 **`[+]` 원형 버튼** (입력 모달 호출).

### #2. 입력/수정 모달 (Input Modal)
*   **진입:** 날짜 2-Tap 또는 하단 `[+]` 버튼.
*   **탭:** `Schedule`, `Expense`, `Income`.
*   **주요 필드:**
    *   **Type:** `[Personal]` / `[Joint]` (공유 그룹일 때만 노출).
    *   **Asset:** 자산 출처 (예: 현금, 카드A).
    *   **Link:** 일정 연결 (선택 사항).
    *   **Save:** 저장 버튼 (탭 성격에 맞는 그라데이션 컬러).

### #3. 햄버거 메뉴 (Side Menu)
*   **프로필:** 닉네임, 내 색상 수정.
*   **캘린더 관리:**
    *   멤버 초대 (ID 검색창 + 초대 발송 버튼).
    *   초대된 멤버 목록 및 관리(내보내기).
*   **앱 설정:**
    *   **가계부 시작일:** `1일`(Default), `설정 팝업 호출`.
    *   **자산 색상 설정:** 개인/공용 색상 커스텀.
    *   **카테고리 / 자산 관리:** 항목 추가 및 수정.

### #4. 하단 탭바 (Bottom Tab)
*   `[캘린더]`: 메인 홈.
*   `[통계]`: 예산, 카테고리, 멤버별 비교 차트.
*   `[자산]`: 자산 원천(Source)별 잔액 관리.

---

## 5. 데이터베이스 구조 (Schema)

*   **Users:** `id`, `email`, `nickname`, `color_code`, `personal_asset_color`
*   **Groups:** `id`, `name`, `joint_asset_color`, `budget_start_day` (기본값 1)
*   **Group_Members:** `group_id`, `user_id`, `status` ('INVITED', 'ACCEPTED')
*   **Invites (New):**
    *   `id`, `group_id`, `inviter_id` (초대한 사람), `invitee_email` (받는 사람), `status` ('PENDING', 'ACCEPTED', 'REJECTED'), `created_at`
*   **Transactions:** `id`, `amount`, `category`, `asset_type` ('PERSONAL', 'JOINT'), `asset_source_id`, `date`